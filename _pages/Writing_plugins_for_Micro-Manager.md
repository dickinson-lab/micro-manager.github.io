---
title: Writing plugins for Micro-Manager
layout: page
section: Extend
---
{% include notice icon="info" content="This documentation is for the current version of Micro-Manager (2.0). For Micro-Manager 1.4 plugins, please see [Writing plugins for Micro-Manager-1.4](writing_plugins_for_Micro-Manager-1.4). " %}


## Introduction
Writing a new Micro-Manager plugin involves two steps. First, you will write, test and debug your code. It is easiest to do this using a "Integrated Development Environment" (IDE) such as NetBeans, Eclipse or IntelliJ.  The instructions below are for NetBeans. 

If you think your plugin will be useful to anyone besides yourself (or if you want to use it on a computer other than the one you developed it on), you will likely want to distribute the plugin in the form of a .jar file that can simply be copied into the `mmplugins` folder and be recognized by Micro- Manager. Micro-Manager 2.0 uses [SciJava's plugin discovery mechanism](https://imagej.net/libs/scijava).  This uses [Java annotations](https://en.wikipedia.org/wiki/Java_annotation) that need to be generated by your build environment.  Currently, we have no idea how to do that from an IDE, so the following instructions (based on [work by SophieH](https://forum.image.sc/t/mm2-projector-plugin-and-library-source-files/41370/13)) will help you use a command-line tool to build plugins that can run in Micro-Manager 2.0. If you figure out how to do this completely within an IDE, please contribute your notes!

## Prerequisites for writing, debugging and packaging plugins
Download and install a recent version of [Micro-Manager](https://micro-manager.org/Micro-Manager_Nightly_Builds). 

Downloaded and install a Java JDK.  Micro-Manager currently is build with JDK8, which can be freely downloaded from [Adoptium](https://adoptium.net/?variant=openjdk8).  

Download and install [Apache NetBeans](https://netbeans.apache.org/download/index.html).

Obtain the Micro-Manager source code: Clone the [Micro-Manager github repository](Micro-Manager_Source_Code). Optionally run the command ```git submodule update --init --recursive``` which will clone all submodules (currently the Core and devices, which you will not need to build a Java plugin).

## Setting up the IDE
These instructions apply to NetBeans, but the workflow should be relatively similar for other IDEs. If you are an expert in Eclipse or IntelliJ, please contribute your notes to this page. 

Launch NetBeans. The first time you run it, you may need to browse to the location of the JDK that you installed above. 

Choose File>>New Project. Under 'Categories' in the left pane, choose 'Java with Ant'. Then, choose a project type in the right pane. For beginners, it is easiest to start by modifying the code for an existing plugin, so choose 'Java Project with Existing Sources'. If you want to start with a blank slate, choose 'Java Class Library' instead. Click Next>.

Give your project a name, and optionally change the location where it is saved. Click Next>.

Next to the 'Source Package Folders' pane, click the 'Add Folder...' button. Find the folder where you cloned the Micro-Manager source code, and navigate to .../micro-manager/plugins/Example (or choose another existing plugin to modify). Click OK, then Next>. At the next screen, no changes are needed; just click Finish. 

Your project should now appear in the left-hand pane of the main window, under the 'Projects' tab. Right-click the project and choose Properties...

In the left-hand navigation pane of the resulting window, choose 'Libraries'. Click the (+) sign next to 'Classpath' and choose 'Add JAR/Folder'. Navigate to the directory of your micro-manager installation (the application this time, not the source code), and select `ij.jar`. Click 'Choose'. Now click the (+) sign and choose 'Add JAR/Folder' once more. Back inside the micro-manager installation directory, navigate to 'plugins/Micro-Manager' and select the following four files: `AcqEngJ-X.X.X.jar`, `MMCoreJ.jar`, `MMJ_.jar` and `scijava-common-X.X.X.jar` (here X.X.X indicate version numbers which can vary depending on your Micro-Manager installation). Click 'Choose'. 

In the left-hand navigation pane, choose 'Run' and set the following parameters:
     * **Main Class:** type in `ij.ImageJ`
     * **Working Directory:** type in your `$INSTALLDIR`
     * **VM options:** for 64 bit systems, type in `-Xmx3000M`, otherwise use `-Xmx600M`. This sets the maximum memory (megabytes) used by Java. If running Micro-Manager 2.0, you also need to supply `-Dforce.annotation.index=true`.
     
Click OK. The project should now be set up. You can edit your code as desired. 

To debug, choose Debug>Debug Project from the menu. This should launch Micro-Manager, and after selecting the demo configuration, you'll be able to run your plugin from the Plugins menu. You can set breakpoints and view variable values from within the IDE. 

You can also Run>Build Project from the menu to produce a .jar file.  If you copy this .jar file into the `mmplugins` directory of your Micro-Manager installation, your plugin should be available when you run your local copy of Micro-Manager. If you only intend to ever use your plugin on the computer where you developed it, this is fine. However, to build a redistributable .jar file, you need to follow the next set of instructions. 

## Building a redistributable .jar file
These instructions will allow you to compile your code for distribution. Note that these instructions will only work on Windows. 

First, download and install [Apache Ant](https://ant.apache.org/bindownload.cgi). 

You will need to set the following environment variables. On Windows, they can be added in
Control Panel &gt; System and Security &gt; System &gt; "Advanced system
settings" &gt; "Environment variables...".

-   `JAVA_HOME`: set to the path to your JDK installation, e.g.
    `C:\Program Files\AdoptOpenJDK\jdk8u181-b13`. Do not add quotes to the value,
    even if it contains spaces.
-   `ANT_HOME`: set to the path to your Ant installation (whereever you
    placed the extracted binary package), e.g. `C:\apache-ant-1.9.16`. Do
    not add quotes to the value, even if it contains spaces.
-   `PATH`: It is convenient to add Ant to the command search path. You
    can append `;%ANT_HOME%\bin` to the end of the System `PATH`
    varialbe, or add a User variable named `PATH` and set its value to
    `%PATH%;%ANT_HOME%\bin`.
    
Verify that the Environment Variables were set correctly and  Ant is working properly by typing ```ant -version```. You should get a reply similar to:
    ```Apache Ant(TM) version 1.9.16 compiled on July 10 2021```

In your terminal application (I use [Git bash](https://git-scm.com/download/win)), cd to the root of the micro-manager source code and ran the two following commands:
```
ant -f buildscripts/fetchdeps.xml
ant build-buildtools
```

## Copy files from binary installation of Micro-Manager
If you had not yet done so, download and install a recent version of [Micro-Manager](https://micro-manager.org/Micro-Manager_Nightly_Builds). Copy the following .jar files from that Micro-Manger installation into the ```build\Java``` folder, which is located in the micro-manager source code folder you cloned (the ```build\Java``` folder should already contain the file ```AntExtensions.jar```):
```
MMJ_.jar
AcqEngJ-X.X.X.jar
MMCoreJ.jar
```

## Build and run your plugin code
Change directory to the folder that contains your plugin source code from above.  For a NetBeans project, this will be the same folder you selected when you set up the project using 'Java Project with Existing Sources', or it may be the ```..\NetBeansProjects\YourProjectName\src``` folder if you wrote your plugin code from scratch.  Once you are in the source folder for your plugin, issue the command ```ant jar```.  This should result in a file ```Example.jar``` in the ```build\Java\plugins``` directory.  Copy this jar file to the ```mmplugins``` folder of your Micro-Manager installation and it should appear in the menu and work.
